<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Sendcloud service point picker: API integration demo</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
  <style>
    body:not(.is-showing-api-result) #postResult {
      display: none;
    }

    .form-label {
      font-weight: bold;
    }

    .form-label,
    .form-check-label {
      display: block;
    }

    .form-label__required {
      font-weight: normal;
    }

    pre:last-child {
      margin-bottom: 0;
    }

    .hljs {
      background-color: #f8f8f8;
    }
  </style>
</head>

<body>
  <main class="container-fluid p-4">
    <div class="page-header">
      <h1>Sendcloud service point picker: API integration demo</h1>
    </div>

    <div class="row mt-4">
      <div class="col-lg-8">
        <div class="card">
          <div class="card-header">
            <h2 id="basic-example" class="card-title">
              Options
            </h2>
          </div>

          <div class="card-body">
            <form action="" class="form-horizontal">
              <div class="row">
                <div class="col-md-2">
                  <label for="apiKey" class="form-label">
                    API key <span class="form-label__required">(required)</span>
                  </label>

                  <code>apiKey</code>
                </div>

                <div class="col-md-10">
                  <input type="text" id="apiKey" class="form-control" />

                  <div class="form-text">
                    You can find your API key on the <a href="https://panel.sendcloud.sc/v2/settings/integrations/manage">integration settings page</a>. It is needed to test the examples below.
                  </div>
                </div>
              </div>

              <div class="row mt-3">
                <div class="col-md-2">
                  <label for="country" class="form-label">
                    Country <span class="form-label__required">(required)</span>
                  </label>

                  <code>country</code>
                </div>

                <div class="col-md-10">
                  <select class="form-select" id="country">
                    <option value="ad">Andorra</option>
                    <option value="at">Austria</option>
                    <option value="be">Belgium</option>
                    <option value="bg">Bulgaria</option>
                    <option value="ch">Switzerland</option>
                    <option value="cz">Czechia</option>
                    <option value="de">Germany</option>
                    <option value="dk">Denmark</option>
                    <option value="ee">Estonia</option>
                    <option value="es">Spain</option>
                    <option value="fi">Finland</option>
                    <option value="fr">France</option>
                    <option value="gb">United Kingdom</option>
                    <option value="gr">Greece</option>
                    <option value="hr">Croatia</option>
                    <option value="hu">Hungary</option>
                    <option value="ie">Ireland</option>
                    <option value="it">Italy</option>
                    <option value="lt">Lithuania</option>
                    <option value="lu">Luxembourg</option>
                    <option value="lv">Latvia</option>
                    <option value="nl" selected>The Netherlands</option>
                    <option value="no">Norway</option>
                    <option value="pl">Poland</option>
                    <option value="pt">Portugal</option>
                    <option value="ro">Romania</option>
                    <option value="se">Sweden</option>
                    <option value="si">Slovenia</option>
                    <option value="sk">Slovakia</option>
                    <option value="ua">Ukraine</option>
                  </select>

                  <div class="form-text">
                    Examples:
                    <code>de</code>,
                    <code>es</code>,
                    <code>fr</code>,
                    <code>gb</code>,
                    <code>it</code>,
                    <code>nl</code>
                  </div>
                </div>
              </div>

              <div class="row mt-3">
                <div class="col-md-2">
                  <label for="language" class="form-label">
                    UI Language <span class="form-label__required">(required)</span>
                  </label>

                  <code>language</code>
                </div>

                <div class="col-md-10">
                  <select class="form-select" id="language">
                    <option value="de-de">Deutsch</option>
                    <option value="en-gb">English (UK)</option>
                    <option value="en-us" selected>English (US)</option>
                    <option value="es-es">Español</option>
                    <option value="fr-fr">Français</option>
                    <option value="it-it">Italiano</option>
                    <option value="nl-nl">Nederlands</option>
                  </select>

                  <div class="form-text">
                    Available options:
                    <code>de-de</code>,
                    <code>en-gb</code>,
                    <code>en-us</code>,
                    <code>es-es</code>,
                    <code>fr-fr</code>,
                    <code>it-it</code>,
                    <code>nl-nl</code>
                  </div>
                </div>
              </div>

              <div class="row mt-3">
                <div class="col-md-2">
                  <label for="postalCode" class="form-label">
                    Postal Code
                  </label>

                  <code>postalCode</code>
                </div>

                <div class="col-md-10">
                  <input class="form-control" type="text" id="postalCode" placeholder="1018 AM" />

                  <div class="form-text">
                    <strong>Note</strong>: if a service point ID is provided, the postal code parameter will be ignored and the service point location will be displayed instead.
                  </div>
                </div>
              </div>

              <div class="row mt-3">
                <div class="col-md-2">
                  <label for="city" class="form-label">
                    City
                  </label>

                  <code>city</code>
                </div>

                <div class="col-md-10">
                  <input class="form-control" type="text" id="city" placeholder="Amsterdam" />

                  <div class="form-text">
                    <strong>Note</strong>: if a service point ID is provided, the city parameter will be ignored and the service point location will be displayed instead.
                  </div>
                </div>
              </div>

              <div class="row mt-3">
                <div class="col-md-2">
                  <label for="servicePointId" class="form-label">
                    Service point ID
                  </label>

                  <code>servicePointId</code>
                </div>

                <div class="col-md-10">
                  <input type="text" id="servicePointId" class="form-control" />

                  <small class="form-text">You can open the service point picker with a service point ID and its location will be shown instead of the country’s default location.</small>
                </div>
              </div>

              <div class="row mt-3">
                <div class="col-md-2">
                  <label for="postNumber" class="form-label">
                    Post number
                  </label>

                  <code>postNumber</code>
                </div>

                <div class="col-md-10">
                  <input type="text" id="postNumber" placeholder="17455093" class="form-control" />
                  <small class="form-text">Pre-fill the service point picker’s post number field.</small>
                </div>
              </div>

              <div class="row mt-3">
                <div class="col-md-2">
                  <span class="form-label">
                    Carriers
                  </span>

                  <code>carriers</code>
                </div>

                <div class="col-md-10">

                  <div class="alert alert-info">
                    <strong>Heads up</strong>: filtering carriers is limited to the carriers selected in your integration settings in the Sendcloud platform.
                  </div>

                  <p>
                    By default, service points from all selected carriers in your integration settings will be available. You can filter the results further by passing a <code>carriers</code> parameter when opening the service point picker.
                  </p>

                  <p>
                    Example values:
                    <code>bpost</code>,
                    <code>chronopost</code>,
                    <code>colissimo</code>,
                    <code>correos</code>,
                    <code>dhl</code>,
                    <code>mondial_relay</code>,
                    <code>poste_italiane</code>,
                    <code>postnl</code>,
                    <code>ups</code>
                  </p>

                  <p>
                    For a full list of supported carrier codes, please check the <a href="https://docs.sendcloud.sc/api/v2/service-points/#list-active-carriers">carrier list endpoint documentation</a> of the service points API.
                  </p>

                  <div>
                    <div class="form-check">
                      <input id="carrier_bpost" class="form-check-input" type="checkbox" name="carriers" value="bpost">
                      <label for="carrier_bpost" class="form-check-label">Bpost</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_chronopost" class="form-check-input" type="checkbox" name="carriers" value="chronopost">
                      <label for="carrier_chronopost" class="form-check-label">Chronopost</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_colissimo" class="form-check-input" type="checkbox" name="carriers" value="colissimo">
                      <label for="carrier_colissimo" class="form-check-label">Colissimo</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_correos" class="form-check-input" type="checkbox" name="carriers" value="correos">
                      <label for="carrier_correos" class="form-check-label">Correos</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_correos_express" class="form-check-input" type="checkbox" name="carriers" value="correos_express">
                      <label for="carrier_correos_express" class="form-check-label">Correos Express</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_dhl" class="form-check-input" type="checkbox" name="carriers" value="dhl">
                      <label for="carrier_dhl" class="form-check-label">DHL</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_dhl_de" class="form-check-input" type="checkbox" name="carriers" value="dhl_de">
                      <label for="carrier_dhl_de" class="form-check-label">DHL Germany</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_dpd" class="form-check-input" type="checkbox" name="carriers" value="dpd">
                      <label for="carrier_dpd" class="form-check-label">DPD</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_dpd_fr" class="form-check-input" type="checkbox" name="carriers" value="dpd_fr">
                      <label for="carrier_dpd_fr" class="form-check-label">DPD France</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_dpd_gb" class="form-check-input" type="checkbox" name="carriers" value="dpd_gb">
                      <label for="carrier_dpd_gb" class="form-check-label">DPD UK</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_dpd_local" class="form-check-input" type="checkbox" name="carriers" value="dpd_local">
                      <label for="carrier_dpd_local" class="form-check-label">DPD (Local)</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_gls_de" class="form-check-input" type="checkbox" name="carriers" value="gls_de">
                      <label for="carrier_gls_de" class="form-check-label">GLS Germany</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_gls_es" class="form-check-input" type="checkbox" name="carriers" value="gls_es">
                      <label for="carrier_gls_es" class="form-check-label">GLS Spain</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_gls_nl" class="form-check-input" type="checkbox" name="carriers" value="gls_nl">
                      <label for="carrier_gls_nl" class="form-check-label">GLS Netherlands</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_hermes_gb" class="form-check-input" type="checkbox" name="carriers" value="hermes_gb">
                      <label for="carrier_hermes_gb" class="form-check-label">Hermes UK</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_hermes_c2c_gb" class="form-check-input" type="checkbox" name="carriers" value="hermes_c2c_gb">
                      <label for="carrier_hermes_c2c_gb" class="form-check-label">Hermes UK (C2C)</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_homerr" class="form-check-input" type="checkbox" name="carriers" value="homerr">
                      <label for="carrier_homerr" class="form-check-label">Homerr</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_inpost_gb" class="form-check-input" type="checkbox" name="carriers" value="inpost_gb">
                      <label for="carrier_inpost_gb" class="form-check-label">Inpost UK</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_mondial_relay" class="form-check-input" type="checkbox" name="carriers" value="mondial_relay">
                      <label for="carrier_mondial_relay" class="form-check-label">Mondial Relay</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_postat" class="form-check-input" type="checkbox" name="carriers" value="postat">
                      <label for="carrier_postat" class="form-check-label">Post AT</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_poste_italiane" class="form-check-input" type="checkbox" name="carriers" value="poste_italiane">
                      <label for="carrier_poste_italiane" class="form-check-label">Poste Italiane</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_postnl" class="form-check-input" type="checkbox" name="carriers" value="postnl">
                      <label for="carrier_postnl" class="form-check-label">PostNL</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_royal_mail" class="form-check-input" type="checkbox" name="carriers" value="royal_mail">
                      <label for="carrier_royal_mail" class="form-check-label">Royal Mail</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_seur" class="form-check-input" type="checkbox" name="carriers" value="seur">
                      <label for="carrier_seur" class="form-check-label">SEUR</label>
                    </div>

                    <div class="form-check">
                      <input id="carrier_ups" class="form-check-input" type="checkbox" name="carriers" value="ups">
                      <label for="carrier_ups" class="form-check-label">UPS</label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="row mt-3">
                <div class="col-md-12">
                  <button type="button" class="btn btn-primary" id="openServicePointPicker">
                    Open service point picker
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <div class="card mt-4">
          <div class="card-header">
            <h2 id="usage" class="card-title">
              Usage
            </h2>
          </div>

          <div class="card-body">
            <p>
              Begin by adding our script to your HTML page:
            </p>

            <pre><code>&lt;script src="https://embed.sendcloud.sc/spp/1.0.0/api.min.js"&gt;&lt;/script&gt;</code></pre>

            <p>
              You need to provide <code>sendcloud.servicePoints.open</code> a config object, a success callback function and an error callback function.
            </p>

            <p>The example on this page uses the following code:</p>

            <pre><code id="exampleCode" class="language-javascript"></code></pre>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div id="postResult" class="card">
          <div class="card-header">
            <h2 id="selected-service-point" class="card-title">
              Selected service point
            </h2>
          </div>

          <div class="card-body">
            <p>
              You now need to send the retrieved data to Sendcloud’s Parcel API (described in <a href="https://docs.sendcloud.sc/api/v2/index.html#parcel" target="_blank" rel="noopener noreferrer nofollow">https://docs.sendcloud.sc/api/v2/index.html#parcel</a>). When creating a new parcel you’ll need to forward the delivery address as stated in the result below among with the service point ID in the <code>to_service_point</code> field. <strong>Be aware that the service point IDs have limited lifetime and change constantly. They weren’t designed for persistance.</strong>
            </p>

            <p>
              When creating shipments with service points <strong>always</strong> send the <code>to_post_number</code> field with the value returned by the service point selection.
            </p>

            <p>
              <strong>Post number:</strong> <span id="postNumberResultElement"></span><br>
              <strong>Service point:</strong>
            </p>

            <pre><code id="servicePointResult" class="language-json"></code></pre>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="https://embed.sendcloud.sc/spp/1.0.0/api.min.js"></script>
  <!-- Usage -->
  <script id="actualExampleCode">
    const apiKeyField = document.getElementById('apiKey')

    const countryField = document.getElementById('country')
    const languageField = document.getElementById('language')

    const postalCodeField = document.getElementById('postalCode')
    const cityField = document.getElementById('city')
    const servicePointIdField = document.getElementById('servicePointId')
    const postNumberField = document.getElementById('postNumber')

    const openServicePointPickerButton = document.getElementById('openServicePointPicker')
    const servicePointResultElement = document.getElementById('servicePointResult')
    const resultPostNumberField = document.getElementById('postNumberResultElement')

    openServicePointPickerButton.addEventListener('click', openServicePointPicker)

    function openServicePointPicker() {
      if (!apiKeyField.value) {
        alert('Missing API key')
      }

      /**
       * @typedef {object} ServicePointPickerOptions
       * @property {string} apiKey Required. Set it to your API key.
       * @property {string} country Required. ISO-2 code of the country you want to display the map in.
       * @property {string} language Optional. Defaults to 'en-us'.
       * @property {string} postalCode Optional. Defaults to '' (empty string).
       * @property {string} city Optional. Defaults to '' (empty string).
       * @property {string} carriers Optional. Comma-separated list of carriers for which to filter service points. If not provided, the service points aren’t filtered.
       * @property {number} servicePointId Optional. Set a pre-selected service point to be shown upon displaying the map.
       * @property {string} postNumber Optional. Set a pre-defined post number to fill its corresponding field upon displaying the map.
       */

      /** @type {ServicePointPickerOptions} */ const options = {
        apiKey: apiKeyField.value,
        country: countryField.value,
        postalCode: postalCodeField.value,
        city: cityField.value,
        carriers: getCarrierList(),
        servicePointId: parseInt(servicePointIdField.value),
        postNumber: postNumberField.value,
        language: languageField.value,
      }

      sendcloud.servicePoints.open(options, successCallback, failureCallback)
    }

    function getCarrierList() {
      const carrierInputs = Array.from(document.querySelectorAll('[name="carriers"]'))
      return carrierInputs
        .filter((carrierInput) => carrierInput.checked)
        .map((carrierInput) => carrierInput.value)
        .join()
    }

    /**
     * Handles the selection of a service point.
     *
     * @param {ServicePoint} servicePoint
     * @param {string} postNumber Used as `to_post_number` field in the Parcel creation API
     */
    function successCallback(servicePoint, postNumber) {
      servicePointResultElement.innerHTML = JSON.stringify(servicePoint, null, 2)
      resultPostNumberField.innerText = postNumber || '—'
      hljs.highlightElement(servicePointResultElement);
      document.body.classList.add('is-showing-api-result')
    }

    /**
     * Handles error events and closing the service point picker.
     *
     * @param {string[]} errors
     */
    function failureCallback(errors) {
      document.body.classList.remove('is-showing-api-result')
      console.error('[Failure callback]', errors.join(', '))
    }
  </script>

  <script>
    const code = document.getElementById('actualExampleCode').innerText.replace(/^\n/, '')
    const indentation = code.match(/^(\s+)/)[0]
    const deIndentedCode = code.split('\n')
      .map((line) => line.startsWith(indentation) ? line.replace(indentation, '') : line)
      .join('\n')
      .trim()
    document.getElementById('exampleCode').innerHTML = deIndentedCode
  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
  <script>
    hljs.highlightAll()
  </script>
</body>

</html>
