<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Sendcloud service point picker: integration examples</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" />

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous" />

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/highlight.js/9.9.0/styles/github.min.css" />
  <style>
    #postResult,
    #result {
      display: none;
    }

    h2 {
      margin-top: 0;
    }

    label {
      display: block;
    }
  </style>
</head>

<body>
  <div class="page-header">
    <h1>Service point picker <small>Examples</small></h1>
  </div>

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-8">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-heading__header" id="api-key">
              API Key*
            </h2>
          </div>

          <div class="panel-body">
            <p>
              An API key is always required. You can find yours in your integration settings page. Please paste it
              below.
            </p>

            <form action="" class="form-horizontal">
              <div class="form-group">
                <label class="col-sm-2" for="apiKey">API Key</label>
                <div class="col-sm-10">
                  <input type="text" placeholder="API Key" id="apiKey" class="form-control" />
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Examples -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-heading__header" id="basic-example">
              Basic Example
            </h2>
          </div>

          <div class="panel-body">
            <p>
              These are the only required parameters, passed to <code>country</code> and <code>language</code> parameters respectively when displaying service points.
            </p>

            <form action="" class="form-horizontal">
              <div class="form-group">
                <label class="col-sm-2" for="country">Country</label>
                <div class="col-sm-10">
                  <select id="country" class="form-control">
                    <option value="be">Belgium</option>
                    <option value="uk">United Kingdom</option>
                    <option value="de">Germany</option>
                    <option value="es">Spain</option>
                    <option value="fr">France</option>
                    <option value="it">Italy</option>
                    <option value="nl" selected>Netherlands</option>
                  </select>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2" for="language">UI Language</label>
                <div class="col-sm-10">
                  <select class="form-control" id="language">
                    <option value="de-de">Deutsch</option>
                    <option value="en-gb">English (UK)</option>
                    <option value="en-us" selected>English (US)</option>
                    <option value="es-es">Español</option>
                    <option value="fr-fr">Français</option>
                    <option value="it-it">Italiano</option>
                    <option value="nl-nl">Nederlands</option>
                  </select>

                  <small>
                    Available options:
                    <code>de-de</code>,
                    <code>en-gb</code>,
                    <code>en-us</code>,
                    <code>es-es</code>,
                    <code>fr-fr</code>,
                    <code>it-it</code>,
                    <code>nl-nl</code>
                  </small>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-10 col-sm-offset-2">
                  <button type="button" class="form-control btn btn-primary" id="basicExample">
                    Select service point
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-heading__header" id="advanced-example">
              Advanced Example
            </h2>
          </div>

          <div class="panel-body">
            <p>
              You may pass additional parameters to the Service Point Picker, like the postal code and previously selected service point identifier.
            </p>

            <form action="" class="form-horizontal">
              <div class="form-group">
                <label class="col-sm-2" for="postalCode">Postal Code</label>
                <div class="col-sm-10">
                  <input class="form-control" type="text" id="postalCode" placeholder="1018 AM" />

                  <small class="help-text">
                    <strong>Heads up!</strong> If a service point ID is provided, the postal code parameter will be ignored and the service point location displayed instead.
                  </small>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2" for="city">City</label>
                <div class="col-sm-10">
                  <input class="form-control" type="text" id="city" placeholder="Amsterdam" />

                  <small class="help-text">
                    <strong>Heads up!</strong> If a service point ID is provided, the city parameter will be ignored and the service point location displayed instead.
                  </small>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2" for="servicePointId">Service Point ID</label>
                <!-- You can pass along a service point ID in order to open the map in a preselected service point -->
                <div class="col-sm-10">
                  <input type="text" id="servicePointId" class="form-control" />

                  <small class="help-text">You can open the service point picker with a Service Point ID and its location will be shown immediately to the user.</small>
                </div>
              </div>

              <div class="form-group">
                <label class="col-sm-2" for="postNumber">Post number</label>
                <!-- Certain service point types may include a post number -->
                <div class="col-sm-10">
                  <input type="text" id="postNumber" placeholder="17455093" class="form-control" />
                  <small class="help-text">Open the service point picker with a Post number and its value will be immediately shown to the user.</small>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-10 col-sm-offset-2">
                  <button type="button" class="form-control btn btn-primary" id="advancedExample">
                    Select service point
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-heading__header" id="filter-carriers">Limiting carriers available to the user</h2>
          </div>

          <div class="panel-body">
            <div class="alert alert-info">
              <strong>Heads up!</strong> filtering carriers is limited to the carriers selected in your integration settings on the Sendcloud platform
            </div>

            <p>
              By default, service points from all selected carriers in your integration settings will be available. You can filter the results further by passing a <code>carriers</code> parameter when opening the service point picker.
            </p>

            <p>
              Example values:
              <code>bpost</code>,
              <code>chronopost</code>,
              <code>colissimo</code>,
              <code>correos</code>,
              <code>dhl</code>,
              <code>mondial_relay</code>,
              <code>poste_italiane</code>,
              <code>postnl</code>,
              <code>ups</code>
            </p>

            <p>
              For a full list of supported carrier codes, please check the <a href="https://docs.sendcloud.sc/api/v2/service-points/#list-active-carriers">carrier list endpoint documentation</a> of the Service Points API.
            </p>

            <form action="" class="form-horizontal">
              <div class="form-group">
                <label for="" class="col-sm-2">Carriers</label>

                <div class="col-sm-10">
                  <div class="checkbox">
                    <label>
                      <input type="checkbox" name="carriers" value="bpost">
                      bpost
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="chronopost">
                      Chronopost
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="colissimo">
                      Colissimo
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="correos">
                      Correos
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="correos_express">
                      Correos Express
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="dhl_de">
                      DHL (Germany)
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="dhl">
                      DHL
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="dpd">
                      DPD
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="dpd_fr">
                      DPD (France)
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="dpd_gb">
                      DPD (UK)
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="dpd_local">
                      DPD (Local)
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="gls_de">
                      GLS (Germany)
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="gls_es">
                      GLS (Spain)
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="gls_nl">
                      GLS (Netherlands)
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="hermes_gb">
                      Hermes (UK)
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="hermes_c2c_gb">
                      Hermes (UK C2C)
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="homerr">
                      Homerr
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="inpost_gb">
                      Inpost (UK)
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="mondial_relay">
                      Mondial Relay
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="postat">
                      Post AT
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="poste_italiane">
                      Poste Italiane
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="postnl">
                      PostNL
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="royal_mail">
                      Royal Mail
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="seur">
                      SEUR
                    </label>

                    <label>
                      <input type="checkbox" name="carriers" value="ups">
                      UPS
                    </label>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <div class="col-sm-10 col-sm-offset-2">
                  <button type="button" class="form-control btn btn-primary" id="limitCarriers">
                    Select service point
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <div class="panel panel-default">
          <div class="panel-heading">
            <h2 class="panel-heading__header" id="quick-start">
              Quickstart
            </h2>
          </div>

          <div class="panel-body">
            <p>
              Begin by adding our script to your HTML page:
            </p>

            <pre><code>&lt;script src="https://embed.sendcloud.sc/spp/1.0.0/api.min.js"&gt;&lt;/script&gt;</code></pre>

            <p>
              You need to provide <code>sendcloud.servicePoints.open</code> a config object, a success callback function and an error callback function.
            </p>

            <p>The example on this page uses the following code:</p>

            <pre><code class="javascript"><span id="example-code"></span></code></pre>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div id="postResult">
          <p>
            You now need to send the retrieved data to Sendcloud's Parcel API (described in <a href="https://docs.sendcloud.sc/api/v2/index.html#parcel" target="_blank" rel="noopener noreferrer nofollow">https://docs.sendcloud.sc/api/v2/index.html#parcel</a>). When creating a new Parcel you'll need to forward the delivery address as stated in the result below among with the service point ID in the <strong>"to_service_point"</strong> field. <strong>Be aware that the service point IDs have limited lifetime and change constantly. They weren't designed for persistance.</strong>
          </p>

          <p>
            When creating shipments with service points <strong>always</strong> send the <code>to_post_number</code> field with the value returned by the service point selection.
          </p>

          <p>
            <strong>Post number:</strong> <span class="result__to-post-number"></span><br>
            <strong>Service point data:</strong>
          </p>
        </div>

        <pre id="result"></pre>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>

  <!-- Dependencies -->

  <script src="https://embed.sendcloud.sc/spp/1.0.0/api.min.js"></script>
  <!-- Usage -->
  <script id="actual-code">
    const apiKeyElem = document.getElementById('apiKey')

    const countryField = document.getElementById('country')
    const languageField = document.getElementById('language')

    const postalCodeField = document.getElementById('postalCode')
    const cityField = document.getElementById('city')
    const servicePointIdField = document.getElementById('servicePointId')
    const postNumberField = document.getElementById('postNumber')

    const resultElem = document.getElementById('result')
    const postResultElem = document.getElementById('postResult')
    const basicExampleButton = document.getElementById('basicExample')
    const advancedExampleButton = document.getElementById('advancedExample')
    const carriersExampleButton = document.getElementById('limitCarriers')

    basicExampleButton.addEventListener('click', function () {
      openServicePointPicker(countryField.value, languageField.value)
    })

    advancedExampleButton.addEventListener('click', function () {
      openServicePointPicker(
        countryField.value,
        languageField.value,
        postalCodeField.value,
        cityField.value,
        null,
        servicePointIdField.value,
        postNumberField.value
      )
    })

    carriersExampleButton.addEventListener('click', function () {
      openServicePointPicker(
        countryField.value,
        languageField.value,
        postalCodeField.value,
        cityField.value,
        getCarrierList()
      )
    })

    function getApiKey() {
      if (!apiKeyElem.value) {
        alert('Missing API key')
      }

      return apiKeyElem.value
    }

    function getCarrierList() {
      const carrierInputs = Array.from(document.querySelectorAll('[name="carriers"]'))
      return carrierInputs
        .filter((carrierInput) => carrierInput.checked)
        .map((carrierInput) => carrierInput.value)
        .join()
    }

    /**
     * @param {string} country
     * @param {'de-de' | 'en-gb' | 'en-us' | 'es-es' | 'fr-fr' | 'it-it' | 'nl-nl'} language
     * @param {string} [postalCode]
     * @param {string} [city]
     * @param {string} [carriers]
     * @param {number} [servicePointId]
     * @param {string} [postNumber]
     */
    function openServicePointPicker(
      country,
      language,
      postalCode,
      city,
      carriers,
      servicePointId,
      postNumber
    ) {
        /**
         * @typedef {object} ConfigurationHash
         * @property {string} apiKey Required. Set it to your API key.
         * @property {string} country Required. ISO-2 code of the country you want to display the map in.
         * @property {string} language Optional. Defaults to 'en-us'.
         * @property {string} postalCode Optional. Defaults to '' (empty string).
         * @property {string} city Optional. Defaults to '' (empty string).
         * @property {string} carriers Optional. Comma-separated list of carriers for which to filter service points. If not provided, the service points aren’t filtered.
         * @property {number} servicePointId Optional. Set a pre-selected service point to be shown upon displaying the map.
         * @property {string} postNumber Optional. Set a pre-defined post number to fill its corresponding field upon displaying the map.
         */

        /** @type {ConfigurationHash} */ const config = {
        apiKey: getApiKey(),
        country,
        postalCode,
        city,
        carriers,
        servicePointId: parseInt(servicePointId),
        postNumber,
        language,
      }

      /**
       * Handles the selection of a service point.
       *
       * @param {ServicePoint} servicePoint
       * @param {string} postNumber Used as `to_post_number` field in the Parcel creation API
       */
      function successCallback(servicePoint, postNumber) {
        resultElem.innerHTML = JSON.stringify(servicePoint, null, 2)
        postResultElem.style.display = 'block'
        postResultElem.querySelector('.result__to-post-number').innerText = postNumber || '—'
        resultElem.style.display = 'block'
      }

      /**
       * Handles error events and closing the service point picker.
       *
       * @param {string[]} errors
       */
      function failureCallback(errors) {
        errors.forEach(function (error) {
          console.log('Failure callback, reason: ' + error)
        })
      }

      sendcloud.servicePoints.open(config, successCallback, failureCallback)
    }
  </script>

  <script type="text/javascript">
    const code = document.getElementById('actual-code').innerText.replace(/^\n/, '')
    const indentation = code.match(/^(\s+)/)[0]
    document.getElementById('example-code').innerText = code.split('\n')
      .map((line) => line.startsWith(indentation) ? line.replace(indentation, '') : line)
      .join('\n')
      .trim()
  </script>
</body>

</html>
